<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Arduino â†’ Google Sheets</title>
</head>

<body>
<h1>Arduino Mega â†’ Google Sheets</h1>
<button id="connect">Connecter lâ€™Arduino</button>
<pre id="log"></pre>

<script>
let port;
let reader;
const logEl = document.getElementById("log");

// ðŸ‘‰ Mets ICI ton URL Apps Script
const URL_SHEETS = "TON_URL_EXEC_ICI";

document.getElementById("connect").addEventListener("click", async () => {
  try {
    if (!("serial" in navigator)) {
      logEl.textContent += "Navigateur incompatible avec Web Serial.\n";
      return;
    }

    port = await navigator.serial.requestPort();
    await port.open({ baudRate: 115200 });
    logEl.textContent += "Port ouvert.\n";

    const decoder = new TextDecoderStream();
    port.readable.pipeTo(decoder.writable);
    reader = decoder.readable.getReader();

    while (true) {
      const { value, done } = await reader.read();
      if (done) break;
      if (!value) continue;

      logEl.textContent += value;

      const lines = value.split("\n");
      for (let line of lines) {
        line = line.trim();
        if (!line || line.startsWith("time_ms")) continue;

        const parts = line.split(",");
        if (parts.length < 4) continue;

        const timeMs = Number(parts[0]);
        const timeSec = Number(parts[1]);
        const rawValue = Number(parts[2]);
        const angleDeg = Number(parts[3]);

        // ðŸ‘‰ Envoi vers Google Sheets
        fetch(URL_SHEETS + "?timeMs=" + timeMs +
              "&timeSec=" + timeSec +
              "&rawValue=" + rawValue +
              "&angleDeg=" + angleDeg);
      }
    }
  } catch (err) {
    logEl.textContent += "\nErreur : " + err + "\n";
  }
});
</script>

</body>
</html>
